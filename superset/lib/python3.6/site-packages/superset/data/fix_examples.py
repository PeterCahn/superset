#!/usr/bin/python
 
import psycopg2, os

from sqlalchemy.engine.url import URL, make_url

def fix_tables():
    """ create tables in the PostgreSQL database"""
    command = """ CREATE TABLE wb_health_population2 (
	NY_GNP_PCAP_CD float8 NULL,
	SE_ADT_1524_LT_FM_ZS float8 NULL,
	SE_ADT_1524_LT_MA_ZS float8 NULL,
	SE_ADT_1524_LT_ZS float8 NULL,
	SE_ADT_LITR_FE_ZS float8 NULL,
	SE_ADT_LITR_MA_ZS float8 NULL,
	SE_ADT_LITR_ZS float8 NULL,
	SE_ENR_ORPH float8 NULL,
	SE_PRM_CMPT_FE_ZS float8 NULL,
	SE_PRM_CMPT_MA_ZS float8 NULL,
	SE_PRM_CMPT_ZS float8 NULL,
	SE_PRM_ENRR float8 NULL,
	SE_PRM_ENRR_FE float8 NULL,
	SE_PRM_ENRR_MA float8 NULL,
	SE_PRM_NENR float8 NULL,
	SE_PRM_NENR_FE float8 NULL,
	SE_PRM_NENR_MA float8 NULL,
	SE_SEC_ENRR float8 NULL,
	SE_SEC_ENRR_FE float8 NULL,
	SE_SEC_ENRR_MA float8 NULL,
	SE_SEC_NENR float8 NULL,
	SE_SEC_NENR_FE float8 NULL,
	SE_SEC_NENR_MA float8 NULL,
	SE_TER_ENRR float8 NULL,
	SE_TER_ENRR_FE float8 NULL,
	SE_XPD_TOTL_GD_ZS float8 NULL,
	SH_ANM_CHLD_ZS float8 NULL,
	SH_ANM_NPRG_ZS float8 NULL,
	SH_CON_1524_FE_ZS float8 NULL,
	SH_CON_1524_MA_ZS float8 NULL,
	SH_CON_AIDS_FE_ZS float8 NULL,
	SH_CON_AIDS_MA_ZS float8 NULL,
	SH_DTH_COMM_ZS float8 NULL,
	SH_DTH_IMRT float8 NULL,
	SH_DTH_INJR_ZS float8 NULL,
	SH_DTH_MORT float8 NULL,
	SH_DTH_NCOM_ZS float8 NULL,
	SH_DTH_NMRT float8 NULL,
	SH_DYN_AIDS float8 NULL,
	SH_DYN_AIDS_DH float8 NULL,
	SH_DYN_AIDS_FE_ZS float8 NULL,
	SH_DYN_AIDS_ZS float8 NULL,
	SH_DYN_MORT float8 NULL,
	SH_DYN_MORT_FE float8 NULL,
	SH_DYN_MORT_MA float8 NULL,
	SH_DYN_NMRT float8 NULL,
	SH_FPL_SATI_ZS float8 NULL,
	SH_H2O_SAFE_RU_ZS float8 NULL,
	SH_H2O_SAFE_UR_ZS float8 NULL,
	SH_H2O_SAFE_ZS float8 NULL,
	SH_HIV_0014 float8 NULL,
	SH_HIV_1524_FE_ZS float8 NULL,
	SH_HIV_1524_KW_FE_ZS float8 NULL,
	SH_HIV_1524_KW_MA_ZS float8 NULL,
	SH_HIV_1524_MA_ZS float8 NULL,
	SH_HIV_ARTC_ZS float8 NULL,
	SH_HIV_KNOW_FE_ZS float8 NULL,
	SH_HIV_KNOW_MA_ZS float8 NULL,
	SH_HIV_ORPH float8 NULL,
	SH_HIV_TOTL float8 NULL,
	SH_IMM_HEPB float8 NULL,
	SH_IMM_HIB3 float8 NULL,
	SH_IMM_IBCG float8 NULL,
	SH_IMM_IDPT float8 NULL,
	SH_IMM_MEAS float8 NULL,
	SH_IMM_POL3 float8 NULL,
	SH_MED_BEDS_ZS float8 NULL,
	SH_MED_CMHW_P3 float8 NULL,
	SH_MED_NUMW_P3 float8 NULL,
	SH_MED_PHYS_ZS float8 NULL,
	SH_MLR_NETS_ZS float8 NULL,
	SH_MLR_PREG_ZS float8 NULL,
	SH_MLR_SPF2_ZS float8 NULL,
	SH_MLR_TRET_ZS float8 NULL,
	SH_MMR_DTHS float8 NULL,
	SH_MMR_LEVE float8 NULL,
	SH_MMR_RISK float8 NULL,
	SH_MMR_RISK_ZS float8 NULL,
	SH_MMR_WAGE_ZS float8 NULL,
	SH_PRG_ANEM float8 NULL,
	SH_PRG_ARTC_ZS float8 NULL,
	SH_PRG_SYPH_ZS float8 NULL,
	SH_PRV_SMOK_FE float8 NULL,
	SH_PRV_SMOK_MA float8 NULL,
	SH_STA_ACSN float8 NULL,
	SH_STA_ACSN_RU float8 NULL,
	SH_STA_ACSN_UR float8 NULL,
	SH_STA_ANV4_ZS float8 NULL,
	SH_STA_ANVC_ZS float8 NULL,
	SH_STA_ARIC_ZS float8 NULL,
	SH_STA_BFED_ZS float8 NULL,
	SH_STA_BRTC_ZS float8 NULL,
	SH_STA_BRTW_ZS float8 NULL,
	SH_STA_DIAB_ZS float8 NULL,
	SH_STA_IYCF_ZS float8 NULL,
	SH_STA_MALN_FE_ZS float8 NULL,
	SH_STA_MALN_MA_ZS float8 NULL,
	SH_STA_MALN_ZS float8 NULL,
	SH_STA_MALR float8 NULL,
	SH_STA_MMRT float8 NULL,
	SH_STA_MMRT_NE float8 NULL,
	SH_STA_ORCF_ZS float8 NULL,
	SH_STA_ORTH float8 NULL,
	SH_STA_OW15_FE_ZS float8 NULL,
	SH_STA_OW15_MA_ZS float8 NULL,
	SH_STA_OW15_ZS float8 NULL,
	SH_STA_OWGH_FE_ZS float8 NULL,
	SH_STA_OWGH_MA_ZS float8 NULL,
	SH_STA_OWGH_ZS float8 NULL,
	SH_STA_PNVC_ZS float8 NULL,
	SH_STA_STNT_FE_ZS float8 NULL,
	SH_STA_STNT_MA_ZS float8 NULL,
	SH_STA_STNT_ZS float8 NULL,
	SH_STA_WAST_FE_ZS float8 NULL,
	SH_STA_WAST_MA_ZS float8 NULL,
	SH_STA_WAST_ZS float8 NULL,
	SH_SVR_WAST_FE_ZS float8 NULL,
	SH_SVR_WAST_MA_ZS float8 NULL,
	SH_SVR_WAST_ZS float8 NULL,
	SH_TBS_CURE_ZS float8 NULL,
	SH_TBS_DTEC_ZS float8 NULL,
	SH_TBS_INCD float8 NULL,
	SH_TBS_MORT float8 NULL,
	SH_TBS_PREV float8 NULL,
	SH_VAC_TTNS_ZS float8 NULL,
	SH_XPD_EXTR_ZS float8 NULL,
	SH_XPD_OOPC_TO_ZS float8 NULL,
	SH_XPD_OOPC_ZS float8 NULL,
	SH_XPD_PCAP float8 NULL,
	SH_XPD_PCAP_PP_KD float8 NULL,
	SH_XPD_PRIV float8 NULL,
	SH_XPD_PRIV_ZS float8 NULL,
	SH_XPD_PUBL float8 NULL,
	SH_XPD_PUBL_GX_ZS float8 NULL,
	SH_XPD_PUBL_ZS float8 NULL,
	SH_XPD_TOTL_CD float8 NULL,
	SH_XPD_TOTL_ZS float8 NULL,
	SI_POV_NAHC float8 NULL,
	SI_POV_RUHC float8 NULL,
	SI_POV_URHC float8 NULL,
	SL_EMP_INSV_FE_ZS float8 NULL,
	SL_TLF_TOTL_FE_ZS float8 NULL,
	SL_TLF_TOTL_IN float8 NULL,
	SL_UEM_TOTL_FE_ZS float8 NULL,
	SL_UEM_TOTL_MA_ZS float8 NULL,
	SL_UEM_TOTL_ZS float8 NULL,
	SM_POP_NETM float8 NULL,
	SN_ITK_DEFC float8 NULL,
	SN_ITK_DEFC_ZS float8 NULL,
	SN_ITK_SALT_ZS float8 NULL,
	SN_ITK_VITA_ZS float8 NULL,
	SP_ADO_TFRT float8 NULL,
	SP_DYN_AMRT_FE float8 NULL,
	SP_DYN_AMRT_MA float8 NULL,
	SP_DYN_CBRT_IN float8 NULL,
	SP_DYN_CDRT_IN float8 NULL,
	SP_DYN_CONU_ZS float8 NULL,
	SP_DYN_IMRT_FE_IN float8 NULL,
	SP_DYN_IMRT_IN float8 NULL,
	SP_DYN_IMRT_MA_IN float8 NULL,
	SP_DYN_LE00_FE_IN float8 NULL,
	SP_DYN_LE00_IN float8 NULL,
	SP_DYN_LE00_MA_IN float8 NULL,
	SP_DYN_SMAM_FE float8 NULL,
	SP_DYN_SMAM_MA float8 NULL,
	SP_DYN_TFRT_IN float8 NULL,
	SP_DYN_TO65_FE_ZS float8 NULL,
	SP_DYN_TO65_MA_ZS float8 NULL,
	SP_DYN_WFRT float8 NULL,
	SP_HOU_FEMA_ZS float8 NULL,
	SP_MTR_1519_ZS float8 NULL,
	SP_POP_0004_FE float8 NULL,
	SP_POP_0004_FE_5Y float8 NULL,
	SP_POP_0004_MA float8 NULL,
	SP_POP_0004_MA_5Y float8 NULL,
	SP_POP_0014_FE_ZS float8 NULL,
	SP_POP_0014_MA_ZS float8 NULL,
	SP_POP_0014_TO float8 NULL,
	SP_POP_0014_TO_ZS float8 NULL,
	SP_POP_0509_FE float8 NULL,
	SP_POP_0509_FE_5Y float8 NULL,
	SP_POP_0509_MA float8 NULL,
	SP_POP_0509_MA_5Y float8 NULL,
	SP_POP_1014_FE float8 NULL,
	SP_POP_1014_FE_5Y float8 NULL,
	SP_POP_1014_MA float8 NULL,
	SP_POP_1014_MA_5Y float8 NULL,
	SP_POP_1519_FE float8 NULL,
	SP_POP_1519_FE_5Y float8 NULL,
	SP_POP_1519_MA float8 NULL,
	SP_POP_1519_MA_5Y float8 NULL,
	SP_POP_1564_FE_ZS float8 NULL,
	SP_POP_1564_MA_ZS float8 NULL,
	SP_POP_1564_TO float8 NULL,
	SP_POP_1564_TO_ZS float8 NULL,
	SP_POP_2024_FE float8 NULL,
	SP_POP_2024_FE_5Y float8 NULL,
	SP_POP_2024_MA float8 NULL,
	SP_POP_2024_MA_5Y float8 NULL,
	SP_POP_2529_FE float8 NULL,
	SP_POP_2529_FE_5Y float8 NULL,
	SP_POP_2529_MA float8 NULL,
	SP_POP_2529_MA_5Y float8 NULL,
	SP_POP_3034_FE float8 NULL,
	SP_POP_3034_FE_5Y float8 NULL,
	SP_POP_3034_MA float8 NULL,
	SP_POP_3034_MA_5Y float8 NULL,
	SP_POP_3539_FE float8 NULL,
	SP_POP_3539_FE_5Y float8 NULL,
	SP_POP_3539_MA float8 NULL,
	SP_POP_3539_MA_5Y float8 NULL,
	SP_POP_4044_FE float8 NULL,
	SP_POP_4044_FE_5Y float8 NULL,
	SP_POP_4044_MA float8 NULL,
	SP_POP_4044_MA_5Y float8 NULL,
	SP_POP_4549_FE float8 NULL,
	SP_POP_4549_FE_5Y float8 NULL,
	SP_POP_4549_MA float8 NULL,
	SP_POP_4549_MA_5Y float8 NULL,
	SP_POP_5054_FE float8 NULL,
	SP_POP_5054_FE_5Y float8 NULL,
	SP_POP_5054_MA float8 NULL,
	SP_POP_5054_MA_5Y float8 NULL,
	SP_POP_5559_FE float8 NULL,
	SP_POP_5559_FE_5Y float8 NULL,
	SP_POP_5559_MA float8 NULL,
	SP_POP_5559_MA_5Y float8 NULL,
	SP_POP_6064_FE float8 NULL,
	SP_POP_6064_FE_5Y float8 NULL,
	SP_POP_6064_MA float8 NULL,
	SP_POP_6064_MA_5Y float8 NULL,
	SP_POP_6569_FE float8 NULL,
	SP_POP_6569_FE_5Y float8 NULL,
	SP_POP_6569_MA float8 NULL,
	SP_POP_6569_MA_5Y float8 NULL,
	SP_POP_65UP_FE_ZS float8 NULL,
	SP_POP_65UP_MA_ZS float8 NULL,
	SP_POP_65UP_TO float8 NULL,
	SP_POP_65UP_TO_ZS float8 NULL,
	SP_POP_7074_FE float8 NULL,
	SP_POP_7074_FE_5Y float8 NULL,
	SP_POP_7074_MA float8 NULL,
	SP_POP_7074_MA_5Y float8 NULL,
	SP_POP_7579_FE float8 NULL,
	SP_POP_7579_FE_5Y float8 NULL,
	SP_POP_7579_MA float8 NULL,
	SP_POP_7579_MA_5Y float8 NULL,
	SP_POP_80UP_FE float8 NULL,
	SP_POP_80UP_FE_5Y float8 NULL,
	SP_POP_80UP_MA float8 NULL,
	SP_POP_80UP_MA_5Y float8 NULL,
	SP_POP_AG00_FE_IN float8 NULL,
	SP_POP_AG00_MA_IN float8 NULL,
	SP_POP_AG01_FE_IN float8 NULL,
	SP_POP_AG01_MA_IN float8 NULL,
	SP_POP_AG02_FE_IN float8 NULL,
	SP_POP_AG02_MA_IN float8 NULL,
	SP_POP_AG03_FE_IN float8 NULL,
	SP_POP_AG03_MA_IN float8 NULL,
	SP_POP_AG04_FE_IN float8 NULL,
	SP_POP_AG04_MA_IN float8 NULL,
	SP_POP_AG05_FE_IN float8 NULL,
	SP_POP_AG05_MA_IN float8 NULL,
	SP_POP_AG06_FE_IN float8 NULL,
	SP_POP_AG06_MA_IN float8 NULL,
	SP_POP_AG07_FE_IN float8 NULL,
	SP_POP_AG07_MA_IN float8 NULL,
	SP_POP_AG08_FE_IN float8 NULL,
	SP_POP_AG08_MA_IN float8 NULL,
	SP_POP_AG09_FE_IN float8 NULL,
	SP_POP_AG09_MA_IN float8 NULL,
	SP_POP_AG10_FE_IN float8 NULL,
	SP_POP_AG10_MA_IN float8 NULL,
	SP_POP_AG11_FE_IN float8 NULL,
	SP_POP_AG11_MA_IN float8 NULL,
	SP_POP_AG12_FE_IN float8 NULL,
	SP_POP_AG12_MA_IN float8 NULL,
	SP_POP_AG13_FE_IN float8 NULL,
	SP_POP_AG13_MA_IN float8 NULL,
	SP_POP_AG14_FE_IN float8 NULL,
	SP_POP_AG14_MA_IN float8 NULL,
	SP_POP_AG15_FE_IN float8 NULL,
	SP_POP_AG15_MA_IN float8 NULL,
	SP_POP_AG16_FE_IN float8 NULL,
	SP_POP_AG16_MA_IN float8 NULL,
	SP_POP_AG17_FE_IN float8 NULL,
	SP_POP_AG17_MA_IN float8 NULL,
	SP_POP_AG18_FE_IN float8 NULL,
	SP_POP_AG18_MA_IN float8 NULL,
	SP_POP_AG19_FE_IN float8 NULL,
	SP_POP_AG19_MA_IN float8 NULL,
	SP_POP_AG20_FE_IN float8 NULL,
	SP_POP_AG20_MA_IN float8 NULL,
	SP_POP_AG21_FE_IN float8 NULL,
	SP_POP_AG21_MA_IN float8 NULL,
	SP_POP_AG22_FE_IN float8 NULL,
	SP_POP_AG22_MA_IN float8 NULL,
	SP_POP_AG23_FE_IN float8 NULL,
	SP_POP_AG23_MA_IN float8 NULL,
	SP_POP_AG24_FE_IN float8 NULL,
	SP_POP_AG24_MA_IN float8 NULL,
	SP_POP_AG25_FE_IN float8 NULL,
	SP_POP_AG25_MA_IN float8 NULL,
	SP_POP_BRTH_MF float8 NULL,
	SP_POP_DPND float8 NULL,
	SP_POP_DPND_OL float8 NULL,
	SP_POP_DPND_YG float8 NULL,
	SP_POP_GROW float8 NULL,
	SP_POP_TOTL float8 NULL,
	SP_POP_TOTL_FE_IN float8 NULL,
	SP_POP_TOTL_FE_ZS float8 NULL,
	SP_POP_TOTL_MA_IN float8 NULL,
	SP_POP_TOTL_MA_ZS float8 NULL,
	SP_REG_BRTH_RU_ZS float8 NULL,
	SP_REG_BRTH_UR_ZS float8 NULL,
	SP_REG_BRTH_ZS float8 NULL,
	SP_REG_DTHS_ZS float8 NULL,
	SP_RUR_TOTL float8 NULL,
	SP_RUR_TOTL_ZG float8 NULL,
	SP_RUR_TOTL_ZS float8 NULL,
	SP_URB_GROW float8 NULL,
	SP_URB_TOTL float8 NULL,
	SP_URB_TOTL_IN_ZS float8 NULL,
	SP_UWT_TFRT float8 NULL,
	country_code varchar(3) NULL,
	country_name varchar(255) NULL,
	region varchar(255) NULL,
	"year" timestamp NULL
)
WITH (
	OIDS=FALSE
) ;

INSERT INTO wb_health_population2
SELECT * FROM wb_health_population;

DROP TABLE wb_health_population;

ALTER TABLE public.wb_health_population2 RENAME TO wb_health_population;

        """
    conn = None
    try:
        # connect to the PostgreSQL server
        uri = os.environ.get('SQLALCHEMY_DATA_URI')
        if uri is not None:
            url = make_url(uri)
            conn = psycopg2.connect(host=url.host, database=url.database, user=url.username, password=url.password, port=url.port)
        else:
            conn = psycopg2.connect('/var/lib/superset/superset.db')
        
        cur = conn.cursor()
        # create table one by one
        cur.execute(command)
        # close communication with the PostgreSQL database server
        cur.close()
        # commit the changes
        conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print("error: ", error)
    finally:
        if conn is not None:
            conn.close()
 
 
if __name__ == '__main__':
    fix_tables()
