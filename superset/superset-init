!#/bin/bash

set -e

# Copy superset configuration file if not present
if [ ! -f /etc/superset/superset_config.py ] ; then
	/bin/cp /usr/local/bin/superset_config.py /etc/superset/
	chown superset:superset /usr/local/bin/superset_config.py
fi

# Init superset.db if not present
if [ ! -f /var/lib/superset/superset.db ] ; then
	touch /var/lib/superset/superset.db
	chown superset:superset /var/lib/superset/superset.db
fi

# Create an admin user
fabmanager create-admin --app superset --username $SUPERSETUSER --firstname $SUPERSETUSER --lastname $SUPERSETUSER --email $SUPERSETUSER@superset.csi.it --password password

# Initialize the database
superset db upgrade

# Create default roles and permissions
superset init