#!/bin/bash

set -e

echo "[superset-init] Initing default user..."

# Init superset.db if not present
if [ ! -f /var/lib/superset/superset.db ] ; then
	touch /var/lib/superset/superset.db
	chmod 755 /var/lib/superset/superset.db
fi

# Create an admin user
echo "Creating admin user: $SUPERSETUSER"
fabmanager create-admin --app superset --username $SUPERSETUSER --firstname $SUPERSETUSER --lastname $SUPERSETUSER --email $SUPERSETUSER@superset.csi.it --password superset

echo "[superset-init] Upgrading DB..."
# Initialize the database
superset db upgrade

echo "[superset-init] Superset Init..."
# Create default roles and permissions
superset init

